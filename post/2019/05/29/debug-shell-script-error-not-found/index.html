<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Debug shell script error: not found - CINAQ</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta itemprop="name" content="Debug shell script error: not found">
<meta itemprop="description" content="Automation engineers often have boring tasks. Their job is to automate repetitive tasks. In the early days of Unix and Linux most automation is done with shell scripts. Nowadays we use higher level configuration management systems like Ansible, Puppet, Salt, etc replacing most of the erroneous scripts with poor error handling, lots of boiler code and more importantly high maintenance cost.
$ ./main.sh ./main.sh: 3: exec: ./external.sh: not found $ ls -l -rwxr-xr-x 1 xiwen xiwen 33 May 29 01:25 external.">
<meta itemprop="datePublished" content="2019-05-29T00:13:37&#43;01:00" />
<meta itemprop="dateModified" content="2019-05-29T00:13:37&#43;01:00" />
<meta itemprop="wordCount" content="611">



<meta itemprop="keywords" content="bash,shell,linux,strace,script,shellscript,exec," /><meta property="og:title" content="Debug shell script error: not found" />
<meta property="og:description" content="Automation engineers often have boring tasks. Their job is to automate repetitive tasks. In the early days of Unix and Linux most automation is done with shell scripts. Nowadays we use higher level configuration management systems like Ansible, Puppet, Salt, etc replacing most of the erroneous scripts with poor error handling, lots of boiler code and more importantly high maintenance cost.
$ ./main.sh ./main.sh: 3: exec: ./external.sh: not found $ ls -l -rwxr-xr-x 1 xiwen xiwen 33 May 29 01:25 external." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cinaq.com/post/2019/05/29/debug-shell-script-error-not-found/" />
<meta property="article:published_time" content="2019-05-29T00:13:37+01:00" />
<meta property="article:modified_time" content="2019-05-29T00:13:37+01:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Debug shell script error: not found"/>
<meta name="twitter:description" content="Automation engineers often have boring tasks. Their job is to automate repetitive tasks. In the early days of Unix and Linux most automation is done with shell scripts. Nowadays we use higher level configuration management systems like Ansible, Puppet, Salt, etc replacing most of the erroneous scripts with poor error handling, lots of boiler code and more importantly high maintenance cost.
$ ./main.sh ./main.sh: 3: exec: ./external.sh: not found $ ls -l -rwxr-xr-x 1 xiwen xiwen 33 May 29 01:25 external."/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="https://cinaq.com/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://cinaq.com/css/main.css" />

        <link id="dark-scheme" rel="stylesheet" type="text/css" href="https://cinaq.com/css/dark.css" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="https://cinaq.com/js/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
		<div class="avatar">
			<a href="https://cinaq.com/">
				<img src="/images/xiwen.png" alt="CINAQ" />
			</a>
		</div>
	
	<h1 class="site-title"><a href="https://cinaq.com/">CINAQ</a></h1>
	<div class="site-description"><p>Food for thought</p><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/xiwenc" title="Github"><i data-feather="github"></i></a></li><li><a href="http://nl.linkedin.com/in/xiwen" title="LinkedIn"><i data-feather="linkedin"></i></a></li><li><a href="https://www.twitter.com/xiwenc" title="Twitter"><i data-feather="twitter"></i></a></li><li><a href="/index.xml" title="RSS"><i data-feather="rss"></i></a></li></ul>
		</nav><span class="scheme-toggle"><a href="#" id="scheme-toggle"></a></div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/post">All posts</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">29</span>
							<span class="rest">May 2019</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">Debug shell script error: not found</h1>
				</div>
			</div>
					
			<div class="markdown">
				<p>Automation engineers often have boring tasks. Their job is to automate repetitive tasks. In the early days of Unix and Linux most automation is done with shell scripts. Nowadays we use higher level configuration management systems like <a href="https://www.ansible.com/">Ansible</a>, <a href="https://puppet.com/">Puppet</a>, <a href="https://www.saltstack.com/">Salt</a>, etc replacing most of the erroneous scripts with poor error handling, lots of boiler code and more importantly high maintenance cost.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ ./main.sh
./main.sh: 3: exec: ./external.sh: not found
$ ls -l
-rwxr-xr-x 1 xiwen xiwen 33 May 29 01:25 external.sh
-rwxr-xr-x 1 xiwen xiwen 38 May 29 02:01 main.sh</code></pre></div>
<!-- raw HTML omitted -->
<p>Even though we have these fantastic tools we often fall back to shell. Itâ€™s still the favorite method of quickly drafting a script improving our efficiency. Also shell scripts are reasonably portable without dependency on some tools that might be absent; every Linux system is shipped with a shell. Since it is so easy to create and use them, shell scripts are still widely used.</p>
<h1 id="poor-feedback-from-shell-script">Poor feedback from shell script</h1>
<p>As pointed out earlier error handling is often minimal in shell scripts. This is a natural consequence because scripts focusses being short. Therefore happy case is the only use case supported. Error handling relies on the child tools/processes to give useful feedback on error.</p>
<p>A simplified case is as follow.</p>
<p>We have our entry-point script called <code>main.sh</code> containing:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#00f">#!/usr/bin/env sh
</span><span style="color:#00f"></span>
exec ./external.sh</code></pre></div>
<p>And our <code>external.sh</code> contains:
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#00f">#!/usr/bin/env sh
</span><span style="color:#00f"></span>
echo Hello $0</code></pre></div></p>
<p>Create these files on your system and make them executable so that you can run them:
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">chmod +x main.sh
chmod +x external.sh</code></pre></div></p>
<p>Running the script <code>./main.sh</code> fails with:
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">./main.sh: 3: exec: ./external.sh: not found</code></pre></div></p>
<p>First reaction is: what does this mean?</p>
<p><code>exec</code> function is complaining about <code>./external.sh</code> cannot be found. At least that was my initial interpretation. However that does not make any sense because <code>./external.sh</code> script does exist. That is very confusing.</p>
<h1 id="debugging-with-strace">Debugging with <code>strace</code></h1>
<p><a href="https://linux.die.net/man/1/strace">Strace</a> is diagnostic utility for Linux. Let&rsquo;s use it to debug our original program. The result of <code>strace ./main.sh</code> looks like:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">... snip ...
read(10, <span style="color:#a31515">&#34;#!/usr/bin/env sh\n\nexec ./extern&#34;</span>..., 8192) = 38
execve(<span style="color:#a31515">&#34;./external.sh&#34;</span>, [<span style="color:#a31515">&#34;./external.sh&#34;</span>], 0x5632d3cf8038 /* 68 vars */)
  = -1 ENOENT (No such file or directory)
write(2, <span style="color:#a31515">&#34;./main.sh: 3: exec: &#34;</span>, 20./main.sh: 3: exec: )    = 20
write(2, <span style="color:#a31515">&#34;./external.sh: not found&#34;</span>, 24./external.sh: not found) = 24
write(2, <span style="color:#a31515">&#34;\n&#34;</span>, 1
)                       = 1
exit_group(127)                         = ?
+++ exited with 127 +++</code></pre></div>
<p>It doesn&rsquo;t give us any new information. Still a confusing error message.</p>
<h1 id="manual-debugging">Manual debugging</h1>
<p>How about we run <code>./external.sh</code> ourselves?
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">bash: ./external.sh: /usr/bin/envsh: bad interpreter:
  No such file or directory</code></pre></div></p>
<p>Aha! There was a typo in the interpreter path on the <a href="https://en.wikipedia.org/wiki/Shebang_(Unix)">shebang</a> line. That resulted in a rather cryptic error message. Fixing the shebang typo to <code>#!/usr/bin/env sh</code> in <code>./external.sh</code> our main script works:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">Hello ./external.sh</code></pre></div>
<h1 id="use-bash-as-alternative">Use <code>bash</code> as alternative</h1>
<p>Let&rsquo;s change our shell interpreter from <a href="https://en.wikipedia.org/wiki/Bourne_shell">Bourne Shell</a> to <a href="https://en.wikipedia.org/wiki/Bash_(Unix_shell)">Bash</a> in <code>main.sh</code>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#00f">#!/usr/bin/env bash
</span><span style="color:#00f"></span>
exec ./external.sh</code></pre></div>
<p>Now the error message is:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">./main.sh: /tmp/external.sh: /usr/bin/envsh: bad interpreter:
  No such file or directory
./main.sh: line 3: /tmp/external.sh: Success</code></pre></div>
<p>The failure is much more clear with <code>bash</code>.</p>
<h1 id="conclusion">Conclusion</h1>
<p>Shell scripts are still very popular because they are easy to write and use; unless the script fails. Then it becomes a hell of a job to debug if the script did not have good error handling in place to point you to the root cause of the failure. Itâ€™s very hard to debug because not all child calls give useful feedback to the user. Most scripts bail out on error and therefore rely on subscripts and programs to give good feedback.</p>
<p>Bottom line is if you don&rsquo;t need to support the old <code>sh</code> Bourne shell, prefer to use the more modern, user friendly and powerful <code>bash</code>. Happy scripting!</p>

			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li><a href="/tags/bash">bash</a></li>
							
							<li><a href="/tags/shell">shell</a></li>
							
							<li><a href="/tags/linux">linux</a></li>
							
							<li><a href="/tags/strace">strace</a></li>
							
							<li><a href="/tags/script">script</a></li>
							
							<li><a href="/tags/shellscript">shellscript</a></li>
							
							<li><a href="/tags/exec">exec</a></li>
							
						</ul>
					
				
			</div><div id="disqus_thread"></div>
<script type="text/javascript">
	(function () {
		
		
		if (window.location.hostname == "localhost")
			return;

		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		var disqus_shortname = 'cinaq';
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the </a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div>2019  Â© Copyright notice |  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-74177616-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
